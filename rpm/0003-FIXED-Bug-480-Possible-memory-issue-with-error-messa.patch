From 559f25b12360b2f1c508e51b6b4ca3194fd13594 Mon Sep 17 00:00:00 2001
From: Jan Wielemaker <J.Wielemaker@cs.vu.nl>
Date: Thu, 14 Apr 2011 14:27:33 +0200
Subject: [PATCH 3/3] FIXED: Bug#480: Possible memory issue with error messages.

Note: this is backported to MeeGo

---
 src/pl-error.c |    6 +++---
 1 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/src/pl-error.c b/src/pl-error.c
index 0c2f42d..f89c800 100644
--- a/src/pl-error.c
+++ b/src/pl-error.c
@@ -81,6 +81,7 @@ rewrite_callable(atom_t *expected, term_t actual)
 int
 PL_error(const char *pred, int arity, const char *msg, PL_error_code id, ...)
 { Definition caller;
+  char msgbuf[50];
   term_t except, formal, swi;
   va_list args;
   int do_throw = FALSE;
@@ -84,12 +85,11 @@ PL_error(const char *pred, int arity, const char *msg, PL_error_code id, ...)
     case ERR_MUST_BE_VAR:
     { int argn = va_arg(args, int);
       term_t bound = va_arg(args, term_t);
-      char buf[50];
 
-      if ( !msg )
-      { Ssprintf(buf, "%d-%s argument",
+      if ( !msg && argn > 0 )
+      { Ssprintf(msgbuf, "%d-%s argument",
 		 argn, argn == 1 ? "st" : argn == 2 ? "nd" : "th");
-	msg = buf;
+	msg = msgbuf;
       }
 
       PL_unify_term(formal,
-- 
1.7.2.3

